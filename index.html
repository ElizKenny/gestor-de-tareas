<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rastreo de H√°bitos</title>
  <link rel="icon" href="data:," />
  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json" />
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Firebase compat + FCM -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-messaging-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script>
    firebase.initializeApp({
      apiKey: "AIzaSyD8xjRR...",
      authDomain: "rastrea-habitos.firebaseapp.com",
      projectId: "rastrea-habitos",
      storageBucket: "rastrea-habitos.appspot.com",
      messagingSenderId: "569699375413",
      appId: "1:569699375413:web:94b80bd879a1db77cf147c"
    });
    // Init FCM
    const messaging = firebase.messaging();
    messaging.requestPermission()
      .then(() => messaging.getToken())
      .then(token => console.log('FCM token:', token))
      .catch(() => console.warn('No permission for notifications'));
  </script>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){/*...*/})(window,document,'script','dataLayer','GTM-PXMTK3B6');</script>
  <!-- Fuentes + estilos -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="styles.css"/>
  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json" />

</head>
<body>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PXMTK3B6"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- Hero -->
  <header class="hero">
    <h1 class="hero-title">Rastrea tus H√°bitos</h1>
    <p class="hero-sub">Convierte tus intenciones en acciones diarias y celebra cada logro.</p>
    <button id="themeToggle" aria-label="Alternar modo oscuro">üåì</button>
    <button id="openModal" class="add-habit-btn">Empezar</button>
    <button id="exportCSV" class="add-habit-btn">Exportar CSV</button>
  </header>

  <!-- Modal Auth -->
  <div id="modal" class="modal hidden">‚Ä¶</div>

  <!-- App Container -->
  <div class="container hidden" id="appContainer">
    <header class="app-header">
      <h2 class="app-title">Rastrea tus H√°bitos</h2>
      <div class="user-bar">
        <span id="greeting"></span>
        <button id="logoutBtn" class="logout-btn">Cerrar sesi√≥n</button>
      </div>
    </header>

    <!-- Calendario FullCalendar -->
    <div id="calendar"></div>

    <!-- Estad√≠sticas -->
    <section class="stats">
      <canvas id="statsChart" aria-label="Gr√°fico de progreso de h√°bitos"></canvas>
    </section>

    <!-- Motivacional & acordeones -->
    <section class="intro">‚Ä¶</section>

    <!-- Formulario con categor√≠a + color -->
    <section class="habit-form-container">
      <div class="habit-form">
        <input id="habitInput" type="text" placeholder="Nuevo h√°bito" aria-label="Nombre del h√°bito"/>
        <input id="descInput"  type="text" placeholder="Descripci√≥n (opcional)" aria-label="Descripci√≥n"/>
        <input id="catInput"   type="text" placeholder="Categor√≠a (opcional)" aria-label="Categor√≠a"/>
        <input id="colorInput" type="color" value="#2ecc71" aria-label="Color de categor√≠a"/>
        <button id="addHabitButton" class="add-habit-btn">A√±adir h√°bito</button>
      </div>
    </section>

    <p id="todayLabel" class="today-label"></p>
  </div>

  <!-- Footer fijo -->
  <footer class="footer">
    <p>Creado con ü§ç</p>
    <p>Por <a href="https://elikenny.com" target="_blank">elikenny</a></p>
  </footer>

  <!-- FullCalendar JS + tu script -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker registrado'))
        .catch(console.error);
    }
  </script>  
  <script src="script.js"></script>
</body>
</html>
